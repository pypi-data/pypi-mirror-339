"use strict";(self.webpackChunkmaap_edsc_jupyter_extension=self.webpackChunkmaap_edsc_jupyter_extension||[]).push([[48],{6169:()=>{},9048:(e,t,r)=>{r.r(t),r.d(t,{default:()=>le});var n=r(7908),a=r(9569),o=r(1808),s=r(513),c=r(128),l=r(2369),i=r(5256),d=r(1647),u=r(6500),p=r.n(u),m=r(2543);const g=e=>e,h=e=>e||"",f=e=>{if(!e)return"";const t=[];return e.forEach((e=>{t.push(e)})),t.join("!")},y=e=>{if(e)return e.split("!")},_=["epsg3413","epsg4326","epsg3031"],b=(e,t)=>Object.keys(e).find((r=>e[r]===t)),v={topic:"fst",term:"fsm",variable_level_1:"fs1",variable_level_2:"fs2",variable_level_3:"fs3",detailed_variable:"fsd"},S=e=>{if(!e)return;const{endDate:t,startDate:r,recurringDayStart:n,recurringDayEnd:a,isRecurring:o}=e,s=[r,t];o&&s.push(n,a);const c=s.filter(Boolean).join(",");return""!==c?c:void 0},C={minute:"2",hour:"3",day:"4",month:"5",year:"6"},k=e=>{if(!e)return{};const[t,r,n="",a=""]=e.split(",");return{endDate:r,startDate:t,recurringDayStart:n,recurringDayEnd:a,isRecurring:!(!n||!a)}},x=(e,t)=>{const r=Object.keys(t);let n={isCwic:!1,granuleIds:[]};if(-1!==r.indexOf(e)){const{[e]:r}=t,a=r.split("!"),o=a.pop();n={isCwic:!1,granuleIds:a.map((e=>`G${e}-${o}`))}}if(-1!==r.indexOf(`c${e}`)){const{[`c${e}`]:r}=t;n={isCwic:!0,granuleIds:r.split("!")}}return n},w={focusedGranule:{shortKey:"g",encode:h,decode:g},keywordSearch:{shortKey:"q",encode:h,decode:g},pointSearch:{shortKey:"sp",encode:h,decode:g},boundingBoxSearch:{shortKey:"sb",encode:h,decode:g},polygonSearch:{shortKey:"polygon",encode:h,decode:g},lineSearch:{shortKey:"line",encode:h,decode:g},circleSearch:{shortKey:"circle",encode:h,decode:g},map:{shortKey:"m",encode:e=>{if(!e)return"";const{base:t,latitude:r,longitude:n,overlays:a,projection:o,zoom:s}=e,c=_.indexOf(o);let l;t.blueMarble&&(l=0),t.trueColor&&(l=1),t.landWaterMap&&(l=2);const i=[];a.referenceFeatures&&i.push(0),a.coastlines&&i.push(1),a.referenceLabels&&i.push(2);const d=[r,n,s,c,l,i.join(",")].join("!");return"0!0!2!1!0!0,2"===d?"":d},decode:e=>{if(!e)return{};const[t,r,n,a,o,s]=e.split("!"),c=parseFloat(t),l=parseFloat(r),i=parseFloat(n),d=_[a];return{base:{blueMarble:"0"===o,trueColor:"1"===o,landWaterMap:"2"===o},latitude:c,longitude:l,overlays:{referenceFeatures:-1!==s.split(",").indexOf("0"),coastlines:-1!==s.split(",").indexOf("1"),referenceLabels:-1!==s.split(",").indexOf("2")},projection:d,zoom:i}}},temporalSearch:{shortKey:"qt",encode:S,decode:k},overrideTemporalSearch:{shortKey:"ot",encode:S,decode:k},featureFacets:{shortKey:"ff",encode:e=>{if(!e)return"";const{customizable:t,mapImagery:r,nearRealTime:n}=e,a=[];r&&a.push("Map Imagery"),n&&a.push("Near Real Time"),t&&a.push("Customizable");const o=a.join("!");return""===o?"":o},decode:e=>{if(!e)return{mapImagery:!1,nearRealTime:!1,customizable:!1};const t=e.split("!");return{mapImagery:-1!==t.indexOf("Map Imagery"),nearRealTime:-1!==t.indexOf("Near Real Time"),customizable:-1!==t.indexOf("Customizable")}}},platformFacets:{shortKey:"fp",encode:f,decode:y},instrumentFacets:{shortKey:"fi",encode:f,decode:y},organizationFacets:{shortKey:"fdc",encode:f,decode:y},projectFacets:{shortKey:"fpj",encode:f,decode:y},processingLevelFacets:{shortKey:"fl",encode:f,decode:y},granuleDataFormatFacets:{shortKey:"gdf",encode:f,decode:y},gridName:{shortKey:"s2n",encode:h,decode:g},gridCoords:{shortKey:"s2c",encode:e=>e?e.trim().replace(/,/g,":").replace(/\s+/g,",").replace(/(^|,)(\d+)($|:)/g,"$1$2-$2$3").replace(/(^|:)(\d+)($|,)/g,"$1$2-$2$3"):"",decode:e=>{if(e)return e.replace(/,/g," ").replace(/:/g,",").replace(/(\d+)-(\d+)/g,((e,t,r)=>t===r?t:e))}},shapefileId:{shortKey:"sf",encode:h,decode:g},tagKey:{shortKey:"tag_key",encode:h,decode:g},hasGranulesOrCwic:{shortKey:"ac",encode:e=>!e||"",decode:e=>{if("true"!==e)return!0}},autocompleteSelected:{shortKey:"as",encode:e=>{if(!e||0===e.length)return"";const t={};return e.forEach((({type:e,fields:r})=>{Object.keys(t).includes(e)?t[e].push(r):t[e]=[r]})),t},decode:e=>{if(!e||(0,m.isEmpty)(e))return;const t=[];return Object.keys(e).forEach((r=>{const n=e[r];Object.keys(n).forEach((e=>{const a=n[e].split(":").slice(-1),[o]=a;t.push({type:r,fields:n[e],value:o})}))})),t}}},I=(e,t)=>{const r=e[w[t].shortKey];return w[t].decode(r)},j=e=>{const t=p().parse(e,{ignoreQueryPrefix:!0,parseArrays:!1}),r=I(t,"focusedGranule"),n=I(t,"map"),a={};a.point=I(t,"pointSearch"),a.boundingBox=I(t,"boundingBoxSearch"),a.polygon=I(t,"polygonSearch"),a.line=I(t,"lineSearch"),a.circle=I(t,"circleSearch");const o={pageNum:1},s={pageNum:1};o.spatial=a,o.keyword=I(t,"keywordSearch"),o.temporal=I(t,"temporalSearch"),o.overrideTemporal=I(t,"overrideTemporalSearch"),o.gridName=I(t,"gridName"),o.tagKey=I(t,"tagKey"),o.hasGranulesOrCwic=I(t,"hasGranulesOrCwic"),s.gridCoords=I(t,"gridCoords");const c={collection:o,granule:s},l=(e=>{const{tl:t}=e;if(!t)return;const[r,n,a,o]=t.split("!"),s=b(C,n);return{center:parseInt(r,10)||void 0,end:parseInt(o,10)||void 0,interval:s,start:parseInt(a,10)||void 0}})(t),i=I(t,"featureFacets"),d=I(t,"granuleDataFormatFacets"),u=I(t,"instrumentFacets"),m=I(t,"organizationFacets"),g=I(t,"platformFacets"),h=I(t,"processingLevelFacets"),f=I(t,"projectFacets"),y=(e=>{if(0===Object.keys(e).length)return;const t=[];return Object.keys(e).forEach((r=>{const n=r.slice(0,-1),a=r.slice(-1),o=b(v,n);o&&(void 0===t[a]&&(t[a]={}),t[a][o]=e[r])})),t.length>0?t:void 0})(t),{collections:_,focusedCollection:S,project:w}=(e=>{if(0===Object.keys(e).length)return{};const{p:t,pg:r}=e;if(!t&&!r)return{};let n,a,o="";const s=[],c={},l=[],i={};return t.split("!").forEach(((e,t)=>{if(""===e)return;-1===s.indexOf(e)&&s.push(e),t>0&&l.push(e),0===t&&(o=e);let n,a,d,u,p,m,g=[],h=[],f=[],y={},_=!1;if(r&&r[t]){({isCwic:d,granuleIds:g}=x("x",r[t])),({isCwic:u,granuleIds:h=[]}=x("a",r[t])),({isCwic:p,granuleIds:f=[]}=x("r",r[t])),a=d||u||p;const{v:e=""}=r[t];"t"===e&&(_=!0),m=(e=>{const{uv:t}=e;if(t)return t.split("!")})(r[t]),y=((e={})=>{const t={};return e.qt&&(t.temporal=k(e.qt)),e.dnf&&(t.dayNightFlag=e.dnf),e.bo&&(t.browseOnly="true"===e.bo),e.oo&&(t.onlineOnly="true"===e.oo),e.cc&&(t.cloudCover=e.cc),e.on&&(t.orbitNumber=e.on),e.ecl&&(t.equatorCrossingLongitude=e.ecl),e.id&&(t.readableGranuleName=e.id.split("!")),e.ecd&&(t.equatorCrossingDate=k(e.ecd)),e.gsk&&(t.sortKey=e.gsk),t})(r[t]),n=(e=>{const{of:t}=e;return t})(r[t])}c[e]={excludedGranuleIds:g,granules:{},granuleFilters:y,isCwic:a,isVisible:_,metadata:{}},t>0&&(i[e]={}),(m||n)&&(i[e]={accessMethods:{opendap:{selectedVariables:m,selectedOutputFormat:n}}}),h.length&&i[e]&&(i[e].addedGranuleIds=h),f.length&&i[e]&&(i[e].removedGranuleIds=f)})),(r||l.length>0)&&(n={allIds:s,byId:c},a={byId:i,collectionIds:l}),{collections:n,focusedCollection:o,project:a}})(t),j={data_center_h:m,instrument_h:u,granule_data_format_h:d,platform_h:g,processing_level_id_h:h,project_h:f,science_keywords_h:y},E={shapefileId:I(t,"shapefileId")},O=(e=>{if(0===Object.keys(e).length)return;const{sr:t}=e;return t?{regionSearch:{selectedRegion:{...t}}}:void 0})(t),N=I(t,"autocompleteSelected"),{collectionIds:P=[]}=w||{};return{advancedSearch:O,autocompleteSelected:N,cmrFacets:j,collections:_,featureFacets:i,focusedCollection:S,focusedGranule:r,map:n,conceptId:[...new Set([...P,S])].filter(Boolean),query:c,shapefile:E,timeline:l}};var E=r(5072),O=r.n(E),N=r(7825),P=r.n(N),R=r(7659),K=r.n(R),q=r(5056),F=r.n(q),L=r(540),T=r.n(L),D=r(1113),A=r.n(D),G=r(2646),M={};M.styleTagTransform=A(),M.setAttributes=F(),M.insert=K().bind(null,"head"),M.domAPI=P(),M.insertStyleElement=T(),O()(G.A,M),G.A&&G.A.locals&&G.A.locals;const B={ignoreCache:!1,headers:{Accept:"text/html, application/json, text/javascript, text/plain"},timeout:5e3};function U(e,t=null){return{ok:!1,status:e.status,statusText:e.statusText,headers:e.getAllResponseHeaders(),data:t||e.statusText,json:()=>JSON.parse(t||e.statusText),url:e.responseURL}}function $(e,t,r={},n=null,a=B){const o=a.ignoreCache||B.ignoreCache,s=a.headers||B.headers,c=a.timeout||B.timeout;return new Promise(((a,l)=>{const i=new XMLHttpRequest;i.open(e,function(e,t={}){const r=function(e={}){return Object.keys(e).map((t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t]))).join("&")}(t);return r?e+(-1===e.indexOf("?")?"?":"&")+r:e}(t,r)),s&&Object.keys(s).forEach((e=>i.setRequestHeader(e,s[e]))),o&&i.setRequestHeader("Cache-Control","no-cache"),i.timeout=c,i.onload=e=>{a(function(e){return{ok:e.status>=200&&e.status<300,status:e.status,statusText:e.statusText,headers:e.getAllResponseHeaders(),data:e.responseText,json:()=>JSON.parse(e.responseText),url:e.responseURL}}(i))},i.onerror=e=>{a(U(i,"Failed to make request."))},i.ontimeout=e=>{a(U(i,"Request took longer than expected."))},"post"===e&&n?(i.setRequestHeader("Content-Type","application/json"),i.send(JSON.stringify(n))):i.send()}))}var z=r(6169),H=r.n(z);let Q=0;class J extends i.Widget{constructor(e){super(),this.id=e+"-"+Q,Q+=1,this.title.label="Earthdata Search",this.title.closable=!0;let t=document.createElement("div");t.classList.add("iframe-widget");let r=document.createElement("iframe");r.id="iframeid",$("get",e).then((t=>{t.ok?r.src=e:(r.setAttribute("baseURI",o.PageConfig.getBaseUrl()),404==t.status||401==t.status||(e="edsc/proxy/"+e,r.src=e))})),t.appendChild(r),this.node.appendChild(t)}}class W extends i.Widget{constructor(){let e=document.createElement("div");e.style.display="flex",e.style.flexDirection="column";let t=H().granuleParams,r=H().collectionParams;null!=t&&0==t.concept_id.length&&(t=null),null!=r&&0==r.concept_id.length&&(r=null),e.innerHTML="<pre>Granule search: "+JSON.stringify(t,null," ")+"</pre><br><pre>Collection search: "+JSON.stringify(r,null," ")+"</pre><br><pre>Results Limit: "+H().limit+"</pre>",super({node:e})}}i.Widget;class V extends i.Widget{constructor(){let e=document.createElement("div");e.style.display="flex",e.style.flexDirection="column",super({node:e}),this.getValue=this.getValue.bind(this);let t=document.createElement("input");t.id="inputLimit",t.value=String(H().limit),this.node.appendChild(t)}getValue(){let e=parseInt(document.getElementById("inputLimit").value);Number.isNaN(e)||e<0?a.Notification.error("Please enter a positive integer for results limit",{autoClose:3e3}):e>Number.MAX_SAFE_INTEGER?a.Notification.error("Please enter a positive integer less than 9007199254740991"):H().limit=e}}const X=(e,t,r,n=!0)=>Z({body:re(e),nonIndexedKeys:t,permittedCmrKeys:r,granule:n}),Z=e=>{const{body:t,nonIndexedKeys:r,permittedCmrKeys:n,granule:a,stringifyResult:o=!0}=e;let s=Y(t,n);return s.concept_id&&0!=s.concept_id.length||(s=null),a?z.granuleParams=s:z.collectionParams=s,o?te(s,r):s},Y=(e={},t)=>{let r=null;r=null==e?{}:e;let n={};return t.forEach((e=>{let t;t=ee(r,"exclude"===e?"excluded_granule_ids":e),t&&(n[e]=t)})),n};function ee(e,t){var r=null;if(e instanceof Array)for(var n=0;n<e.length&&!(r=ee(e[n],t));n++);else for(var a in e){if(a==t&&e[a])return e[a];if((e[a]instanceof Object||e[a]instanceof Array)&&(r=ee(e[a],t)))break}return r}const te=(e,t=[])=>{const r={},n={...e};return t.forEach((e=>{r[e]=n[e],delete n[e]})),Object.keys(n).forEach((e=>{"object"==typeof n[e]&&Object.keys(n[e]).includes("0")&&(n[e]=n[e][0])})),[(0,u.stringify)(n),(0,u.stringify)(r,{indices:!1,arrayFormat:"brackets"})].filter(Boolean).join("&")};function re(e){if("object"!=typeof e)return e;for(let t in e){let r=t.replace(/([A-Z])/g,(function(e){return"_"+e.toLowerCase()}));r!=t&&e.hasOwnProperty(t)&&(e[r]=e[t],delete e[t]),"object"==typeof e[r]&&(e[r]=re(e[r]))}return e}const ne=["concept_id","bounding_box","circle","browse_only","cloud_cover","day_night_flag","echo_collection_id","equator_crossing_date","equator_crossing_longitude","exclude","line","online_only","options","orbit_number","page_num","page_size","point","polygon","readable_granule_name","sort_key","temporal","two_d_coordinate_system"],ae=["concept_id","exclude","readable_granule_name","sort_key"],oe=["bounding_box","circle","collection_data_type","concept_id","data_center_h","data_center","echo_collection_id","facets_size","format","granule_data_format","granule_data_format_h","has_granules_or_cwic","has_granules","include_facets","include_granule_counts","include_has_granules","include_tags","instrument","instrument_h","keyword","line","options","page_num","page_size","platform","platform_h","point","polygon","processing_level_id_h","project_h","project","provider","science_keywords_h","sort_key","spatial_keyword","tag_key","temporal","two_d_coordinate_system"],se=["collection_data_type","concept_id","data_center_h","granule_data_format","granule_data_format_h","instrument","instrument_h","platform","platform_h","processing_level_id_h","project_h","provider","sort_key","spatial_keyword","tag_key"];let ce="";$("get",new URL(o.PageConfig.getBaseUrl()+"jupyter-server-extension/getConfig").href).then((e=>{if(e.ok){let t=JSON.parse(e.data);ce="https://"+t.edsc_server}}));const le={id:"edsc_extension",autoStart:!0,requires:[s.IDocumentManager,a.ICommandPalette,n.ILayoutRestorer,c.IMainMenu,l.INotebookTracker],activate:function(e,t,r,n,s,c,u){let p;const m="tracker-iframe";let g=new a.WidgetTracker({namespace:m});function h(t,r,n="granule"){const s=function(t){const r=c.currentWidget;return!1!==t.activate&&r&&e.shell.activateById(r.id),r}(t);if(H().granuleParams&&0!=Object.keys(H().granuleParams).length)if("query"==r){var i=new URL(o.PageConfig.getBaseUrl()+"jupyter-server-extension/edsc/getQuery");"granule"===n?(i.searchParams.append("cmr_query",H().granuleQuery),i.searchParams.append("query_type","granule")):(i.searchParams.append("cmr_query",H().collectionQuery),i.searchParams.append("query_type","collection")),i.searchParams.append("limit",String(H().limit));var u=new XMLHttpRequest;let e="";u.onload=function(){if(200==u.status){let t=d.parseJSON(u.response);if(e=t.query_string,""==e&&(e="No results found."),s){l.NotebookActions.insertBelow(s.content),l.NotebookActions.paste(s.content),s.content.mode="edit";const t="# generated from this EDSC search: "+H().edscUrl+"\n"+e;s.content.activeCell&&s.content.activeCell.model.sharedModel.setSource(t)}}else console.log("Error making call to get query. Status is "+u.status),a.Notification.error("Error making call to get search query. Have you selected valid search parameters?",{autoClose:3e3})},u.onerror=function(){console.error("Error making call to get query")},u.open("GET",i.href,!0),u.send(null)}else{(i=new URL(o.PageConfig.getBaseUrl()+"jupyter-server-extension/edsc/getGranules")).searchParams.append("cmr_query",H().granuleQuery),i.searchParams.append("limit",String(H().limit));const e=function(e,t){return new Promise(((r,n)=>{var a=new XMLHttpRequest;let o=[];a.onload=function(){if(200==a.status){let t=d.parseJSON(a.response).granule_urls;if(""==t&&(t="No results found."),o=t,e){l.NotebookActions.insertBelow(e.content),l.NotebookActions.paste(e.content),e.content.mode="edit";const t="# generated from this EDSC search: "+H().edscUrl+"\n"+o;e.content.activeCell&&(e.content.activeCell.model.value.text=t)}r("Success")}else console.log("Error making call to get results. Status is "+a.status),n("Error making call to get search results. Have you selected valid search parameters?")},a.onerror=function(){console.log("Error making call to get results")},a.open("GET",t.href,!0),a.send(null)}))}(s,i);a.Notification.promise(e,{pending:{message:"Getting granule search results",options:{autoClose:3e3}},success:{message:(e,t)=>"Pasting granule search results successful"},error:{message:(e,t)=>`${e}`}})}else a.Notification.error("Error: No Search Selected. Select collections through the green plus in EarthData Search Client.",{autoClose:3e3})}window.addEventListener("message",(e=>{if("string"==typeof e.data){H().edscUrl=e.data;const t="?"+e.data.split("?")[1],r=j(t);H().granuleQuery="https://fake.com/?"+X(r,ae,ne,!0),H().collectionQuery="https://fake.com/?"+X(r,se,oe,!1)}}));const f="iframe:open";e.commands.addCommand(f,{label:"Open EarthData Search",isEnabled:()=>!0,execute:t=>{null==p?(p=new J(ce),e.shell.add(p,"main"),e.shell.activateById(p.id)):(e.shell.add(p,"main"),e.shell.activateById(p.id)),g.has(p)||g.add(p)}}),r.addItem({command:f,category:"Search"});const y="search:displayParams";e.commands.addCommand(y,{label:"View Selected Search Parameters",isEnabled:()=>!0,execute:e=>{(0,a.showDialog)({title:"Current Search Parameters:",body:new W,focusNodeSelector:"input",buttons:[a.Dialog.okButton({label:"Ok"})]})}}),r.addItem({command:y,category:"Search"});const _="search:pasteCollectionQuery";e.commands.addCommand(_,{label:"Paste Collection Search Query",isEnabled:()=>!0,execute:e=>{h(e,"query","collection")}}),r.addItem({command:_,category:"Search"});const b="search:pasteGranuleQuery";e.commands.addCommand(b,{label:"Paste Granule Search Query",isEnabled:()=>!0,execute:e=>{h(e,"query","granule")}}),r.addItem({command:b,category:"Search"});const v="search:pasteResults";e.commands.addCommand(v,{label:"Paste Granule Search Results",isEnabled:()=>!0,execute:e=>{h(e,"results")}}),r.addItem({command:v,category:"Search"});const S="search:setLimit";e.commands.addCommand(S,{label:"Set Results Limit",isEnabled:()=>!0,execute:e=>{(0,a.showDialog)({title:"Set Results Limit:",body:new V,focusNodeSelector:"input",buttons:[a.Dialog.okButton({label:"Ok"})]})}}),r.addItem({command:S,category:"Search"});const{commands:C}=e;let k=new i.Menu({commands:C});return k.title.label="Data Search",[f,y,_,b,v,S].forEach((e=>{k.addItem({command:e})})),s.addMenu(k,!0,{rank:100}),n.restore(g,{command:f,name:()=>m}),console.log("JupyterLab MAAP Earth Data Search Client extension is activated!"),H().limit=100,H().granuleParams=null,H().collectionParams=null,g}}},2646:(e,t,r)=>{r.d(t,{A:()=>c});var n=r(1601),a=r.n(n),o=r(6314),s=r.n(o)()(a());s.push([e.id,"div.iframe-widget {\n    height:100%;\n    width:100%;\n}\n\ndiv.iframe-widget iframe{\n    height:100%;\n    width:100%;\n}\n.btn{\n    border: none;\n    box-sizing: border-box;\n    outline: none;\n    -webkit-appearance: none;\n    -moz-appearance: none;\n    margin: 4px;\n    padding: 5px 7px;\n    /*border-radius: 0;*/\n}\n\n.btn:hover {\n    background-color: #eeeeee;\n}",""]);const c=s}}]);