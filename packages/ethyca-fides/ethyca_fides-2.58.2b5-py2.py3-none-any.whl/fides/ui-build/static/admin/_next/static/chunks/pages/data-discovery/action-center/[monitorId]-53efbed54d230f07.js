(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2423],{86850:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/data-discovery/action-center/[monitorId]",function(){return s(56856)}])},37059:function(e,t,s){"use strict";s.d(t,{Ak:function(){return g},EY:function(){return c},Ud:function(){return o},Vr:function(){return y},WJ:function(){return a},nP:function(){return d},nS:function(){return u},rs:function(){return l},sX:function(){return m},wi:function(){return r}});var n=s(78780),i=s(16394);let{useGetAggregateMonitorResultsQuery:o,useGetDiscoveredSystemAggregateQuery:r,useGetDiscoveredAssetsQuery:a,useAddMonitorResultSystemsMutation:l,useIgnoreMonitorResultSystemsMutation:d,useAddMonitorResultAssetsMutation:c,useIgnoreMonitorResultAssetsMutation:u,useUpdateAssetsSystemMutation:m,useUpdateAssetsDataUseMutation:g,useUpdateAssetsMutation:y}=n.u.injectEndpoints({endpoints:e=>({getAggregateMonitorResults:e.query({query:e=>{let{page:t=1,size:s=20,search:n}=e;return{url:"/plus/discovery-monitor/aggregate-results",params:{page:t,size:s,search:n,diff_status:"addition"}}},providesTags:["Discovery Monitor Results"]}),getDiscoveredSystemAggregate:e.query({query:e=>{let{key:t,page:s=1,size:n=20,search:i}=e;return{url:"/plus/discovery-monitor/system-aggregate-results",params:{monitor_config_id:t,page:s,size:n,search:i,diff_status:"addition"}}},providesTags:["Discovery Monitor Results"]}),getDiscoveredAssets:e.query({query:e=>{let{key:t,system:s,page:n=1,size:i=20,search:o,diff_status:r}=e;return{url:"/plus/discovery-monitor/".concat(t,"/results"),params:{resolved_system_id:s,page:n,size:i,search:o,diff_status:r,sort_by:"urn"}}},providesTags:()=>["Discovery Monitor Results"]}),addMonitorResultSystems:e.mutation({query:e=>{let{monitor_config_key:t,resolved_system_ids:s}=e,n=(0,i.du)(s,"resolved_system_ids");return{method:"POST",url:"/plus/discovery-monitor/".concat(t,"/promote?").concat(n)}},invalidatesTags:["Discovery Monitor Results"]}),ignoreMonitorResultSystems:e.mutation({query:e=>{let{monitor_config_key:t,resolved_system_ids:s}=e,n=(0,i.du)(s,"resolved_system_ids");return{method:"POST",url:"/plus/discovery-monitor/".concat(t,"/mute?").concat(n)}},invalidatesTags:["Discovery Monitor Results"]}),addMonitorResultAssets:e.mutation({query:e=>{var t;let s=new URLSearchParams;return null===(t=e.urnList)||void 0===t||t.forEach(e=>s.append("staged_resource_urns",e)),{method:"POST",url:"/plus/discovery-monitor/promote?".concat(s)}},invalidatesTags:["Discovery Monitor Results"]}),ignoreMonitorResultAssets:e.mutation({query:e=>{var t;let s=new URLSearchParams;return null===(t=e.urnList)||void 0===t||t.forEach(e=>s.append("staged_resource_urns",e)),{method:"POST",url:"/plus/discovery-monitor/mute?".concat(s)}},invalidatesTags:["Discovery Monitor Results"]}),updateAssetsSystem:e.mutation({query:e=>({method:"PATCH",url:"/plus/discovery-monitor/".concat(e.monitorId,"/results"),body:e.urnList.map(t=>({urn:t,user_assigned_system_key:e.systemKey}))}),invalidatesTags:["Discovery Monitor Results","System Assets"]}),updateAssetsDataUse:e.mutation({query:e=>({method:"PATCH",url:"/plus/discovery-monitor/".concat(e.monitorId,"/results"),body:e.urnList.map(t=>({urn:t,user_assigned_data_uses:e.dataUses}))}),invalidatesTags:["Discovery Monitor Results"]}),updateAssets:e.mutation({query:e=>({method:"PATCH",url:"/plus/discovery-monitor/".concat(e.monitorId,"/results"),body:e.assets}),invalidatesTags:["Discovery Monitor Results"]})})})},56856:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return P}});var n=s(24246),i=s(86677),o=s(35287),r=s(77830),a=s(58754),l=s(59003),d=s(92222),c=s(77181),u=s(27378),m=s(812),g=s(14047),y=s(14481),v=s(37059),h=s(31883),p=s(57454),f=s(8411),_=s(72625),x=s(34929),w=s(78238),b=e=>{var t,s;let{system:i}=e,{getDataUseDisplayName:o}=(0,x.Z)(),r=(null!==(s=null===(t=i.data_uses)||void 0===t?void 0:t.filter(e=>(0,w.Z)(e)))&&void 0!==s?s:[]).map(e=>({label:o(e),key:e}));return(0,n.jsx)(_.mb,{values:r})};let j=e=>{let{monitorId:t,system:s}=e,[i,{isLoading:o}]=(0,v.rs)(),[a,{isLoading:l}]=(0,v.nP)(),{successAlert:d,errorAlert:u}=(0,g.V)(),y=o||l,{id:h,name:p,system_key:f,total_updates:_}=s,x=async()=>{let e=await i({monitor_config_key:t,resolved_system_ids:[h]});(0,m.D4)(e)?u((0,m.e$)(e.error)):d(f?"".concat(_," assets from ").concat(p," have been added to the system inventory."):"".concat(p," and ").concat(_," assets have been added to the system inventory. ").concat(p," is now configured for consent."),"Confirmed")},w=async()=>{let e=await a({monitor_config_key:t,resolved_system_ids:[h||r.Kl]});(0,m.D4)(e)?u((0,m.e$)(e.error)):d(p?"".concat(_," assets from ").concat(p," have been ignored and will not appear in future scans."):"".concat(_," uncategorized assets have been ignored and will not appear in future scans."),"Confirmed")};return(0,n.jsxs)(c.vyj,{children:[(0,n.jsx)(c.esZ,{title:s.id?void 0:"These assets must be categorized before you can add them to the inventory.",children:(0,n.jsx)(c.wpx,{"data-testid":"add-btn",size:"small",onClick:x,disabled:!s.id||y,loading:o,children:"Add"})}),(0,n.jsx)(c.wpx,{"data-testid":"ignore-btn",size:"small",onClick:w,disabled:y,loading:l,children:"Ignore"})]})};var k=s(56839);let R=e=>{let{system:t}=e;return(0,n.jsxs)(c.kCb,{alignItems:"center",height:"100%",children:[!(null==t?void 0:t.system_key)&&(0,n.jsx)(c.ua7,{label:"New system",children:(0,n.jsx)("span",{children:k.QL.Change})}),(0,n.jsx)(c.xvT,{fontSize:"xs",fontWeight:"semibold",lineHeight:4,overflow:"hidden",textOverflow:"ellipsis",children:(null==t?void 0:t.name)||"Uncategorized assets"})]})},C=e=>{let t=(0,d.Cl)();return{columns:[t.display({id:"select",cell:e=>{let{row:t}=e;return(0,n.jsx)(y.k,{isChecked:t.getIsSelected(),onChange:t.getToggleSelectedHandler(),dataTestId:"select-".concat(t.original.name||t.id)})},header:e=>{let{table:t}=e;return(0,n.jsx)(y.k,{isChecked:t.getIsAllPageRowsSelected(),isIndeterminate:t.getIsSomeRowsSelected(),onChange:t.getToggleAllRowsSelectedHandler(),dataTestId:"select-all-rows"})},maxSize:40,meta:{disableRowClick:!0}}),t.accessor(e=>e.name,{id:"system_name",cell:e=>(0,n.jsx)(R,{system:e.row.original}),header:"System",size:300}),t.accessor(e=>e.total_updates,{id:"total_updates",cell:e=>(0,n.jsx)(y.G3,{value:e.getValue()}),header:"Assets",size:80}),t.display({id:"data_use",cell:e=>(0,n.jsx)(b,{system:e.row.original}),header:"Categories of consent",size:400,meta:{disableRowClick:!0}}),t.accessor(e=>e.locations,{id:"locations",cell:e=>(0,n.jsx)(_.mb,{values:e.getValue().map(e=>({label:f.Z8[e],key:e}))}),header:"Locations",size:300,meta:{showHeaderMenu:!0,disableRowClick:!0}}),t.accessor(e=>e.domains,{id:"domains",cell:e=>(0,n.jsx)(_.tc,{values:e.getValue(),valueSuffix:"domains",cellProps:e}),header:"Domains",meta:{showHeaderMenu:!0,disableRowClick:!0}}),t.display({id:"actions",cell:t=>(0,n.jsx)(j,{system:t.row.original,monitorId:e}),header:"Actions",meta:{disableRowClick:!0}})]}},S=e=>{let{monitorId:t}=e,s=(0,i.useRouter)(),{PAGE_SIZES:o,pageSize:a,setPageSize:f,onPreviousPageClick:_,isPreviousPageDisabled:x,onNextPageClick:w,isNextPageDisabled:b,startRange:j,endRange:k,pageIndex:R,setTotalPages:S,resetPageIndexToDefault:P}=(0,y.oi)(),[T,{isLoading:A}]=(0,v.rs)(),[D,{isLoading:M}]=(0,v.nP)(),{successAlert:I,errorAlert:z}=(0,g.V)(),[E,q]=(0,u.useState)(""),[L,N]=(0,u.useState)({});(0,u.useEffect)(()=>{P()},[t,E,P]);let{data:H,isLoading:U,isFetching:Z}=(0,v.wi)({key:t,page:R,size:a,search:E});(0,u.useEffect)(()=>{H&&S(H.pages||1)},[H,S]);let{columns:O}=C(t),V=(0,l.b7)({getCoreRowModel:(0,d.sC)(),columns:O,manualPagination:!0,data:(null==H?void 0:H.items)||[],columnResizeMode:"onChange",onRowSelectionChange:N,state:{rowSelection:L}}),K=V.getSelectedRowModel().rows,$=K.some(e=>null===e.original.id);if(U)return(0,n.jsx)(y.I4,{rowHeight:36,numRows:36});let W=async()=>{let e=K.reduce((e,t)=>e+t.original.total_updates,0),s=await T({monitor_config_key:t,resolved_system_ids:K.map(e=>e.original.id)});(0,h.D4)(s)?z((0,m.e$)(s.error)):(I("".concat(e," assets have been added to the system inventory.")),N({}))},X=async()=>{let e=K.reduce((e,t)=>e+t.original.total_updates,0),s=await D({monitor_config_key:t,resolved_system_ids:K.map(e=>{var t;return null!==(t=e.original.id)&&void 0!==t?t:r.Kl})});(0,h.D4)(s)?z((0,m.e$)(s.error)):(I("".concat(e," assets have been ignored and will not appear in future scans.")),N({}))};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(y.Q$,{children:(0,n.jsxs)(c.kCb,{direction:"row",alignItems:"center",justifyContent:"space-between",width:"full",children:[(0,n.jsx)(c.kCb,{gap:6,align:"center",children:(0,n.jsx)(c.xuv,{flexShrink:0,children:(0,n.jsx)(p.M,{value:E,onChange:q})})}),(0,n.jsxs)(c.kCb,{align:"center",children:[!!K.length&&(0,n.jsx)(c.xvT,{fontSize:"xs",fontWeight:"semibold",minW:16,mr:6,"data-testid":"selected-count",children:"".concat(K.length," selected")}),(0,n.jsxs)(c.v2r,{children:[(0,n.jsx)(c.j2t,{as:c.wpx,icon:(0,n.jsx)(c.PJP._ME,{}),iconPosition:"end",loading:A||M,"data-testid":"bulk-actions-menu",disabled:!K.length,type:"primary",children:"Actions"}),(0,n.jsxs)(c.qyq,{children:[(0,n.jsx)(c.esZ,{title:$?"Uncategorized assets can't be added to the inventory":null,placement:"left",children:(0,n.jsx)(c.sNh,{fontSize:"small",onClick:W,"data-testid":"bulk-add",isDisabled:$,children:"Add"})}),(0,n.jsx)(c.sNh,{fontSize:"small",onClick:X,"data-testid":"bulk-ignore",children:"Ignore"})]})]})]})]})}),(0,n.jsx)(y.ZK,{tableInstance:V,onRowClick:e=>{var n;s.push("".concat(r.vi,"/").concat(t,"/").concat(null!==(n=e.id)&&void 0!==n?n:r.Kl))},emptyTableNotice:(0,n.jsx)(c.oj8,{image:c.oj8.PRESENTED_IMAGE_SIMPLE,description:"All caught up!"})}),(0,n.jsx)(y.s8,{totalRows:(null==H?void 0:H.total)||0,pageSizes:o,setPageSize:f,onPreviousPageClick:_,isPreviousPageDisabled:x||Z,onNextPageClick:w,isNextPageDisabled:b||Z,startRange:j,endRange:k})]})};var P=()=>{let e=decodeURIComponent((0,i.useRouter)().query.monitorId);return(0,n.jsxs)(o.Z,{title:"Action center - Discovered assets by system",children:[(0,n.jsx)(a.Z,{heading:"Action center",breadcrumbItems:[{title:"All activity",href:r.vi},{title:e}]}),(0,n.jsx)(S,{monitorId:e})]})}},31883:function(e,t,s){"use strict";s.d(t,{Bw:function(){return n.Bw},D4:function(){return n.D4}});var n=s(19043)}},function(e){e.O(0,[8033,6060,2858,2866,9278,4481,9999,146,2888,9774,179],function(){return e(e.s=86850)}),_N_E=e.O()}]);