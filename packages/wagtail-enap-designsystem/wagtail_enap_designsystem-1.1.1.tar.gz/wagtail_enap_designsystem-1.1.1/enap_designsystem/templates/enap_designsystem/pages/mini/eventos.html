{% extends "coderedcms/blocks/base_block.html" %}
{% load wagtailcore_tags wagtailimages_tags %}
{% block block_render %}
{% load static %}
<script src="https://kit.fontawesome.com/2e8803d931.js" crossorigin="anonymous"></script>
<section class="events-section">
    <div class="wrapper-texts">
        <h2 class="h2-title">Eventos e Oficinas</h2>
        <h4 class="sub-title">Acompanhe os próximos eventos da Enap</h4>
    </div>
    
    <div class="wrapper">
        <div class="events-carousel-container" id="events-carousel-container">
            <div class="events-carousel-items" id="events-carousel-items">
                {% for page in pages %}
                <div class="events-carousel-item">
                    <a href="{% pageurl page %}" class="events-item-link">
                        <div class="events-carousel-item-content">
                            <div class="events-carousel-datetime">
                                <div class="event-date">
                                    <span class="event-day">{{ page.seo_published_at|date:"d" }}</span>
                                    <div class="event-month-year">
                                        <span class="text-date">{{ page.seo_published_at|date:"F" }}</span>
                                        <span class="text-date">{{ page.seo_published_at|date:"Y" }}</span>
                                    </div>
                                    <span class="text-date">{{ page.seo_published_at|date:"l" }}</span>
                                </div>
                                {% if page.event_date %}
                                <p class="event-time">{{ page.event_date|date:"d/m/Y H:i" }}</p>
                                {% endif %}
                            </div>
                            <div class="events-carousel-content">
                                <div class="event-tag">Evento</div>
                                <h3 class="events-title">{{ page.title }}</h3>
                                <p class="card-text">{{ page.body_preview }}</p>
                                <div class="event-location"><i class="fa-solid fa-location-dot"></i> Presencial</div>
                            </div>
                        </div>
                    </a>
                </div>
                {% empty %}
                <div class="events-carousel-item">
                    <p>Nenhum evento disponível.</p>
                </div>
                {% endfor %}
            </div>
            <button class="events-carousel-control events-carousel-control-prev"><img style="width: 40px; height: 40px;" src="{% static 'enap_designsystem/icons/iconleft.svg' %}" alt="Passar pro lado esquerdo"></button>
            <button class="events-carousel-control events-carousel-control-next"><img style="width: 40px; height: 40px;" src="{% static 'enap_designsystem/icons/iconrig.svg' %}" alt="Passar pro lado direito"></button>
        </div>
    </div>

    
        <a class="btn-todos" href="{% pageurl value.indexed_by %}" class="btn-todos">Ver todos os eventos</a>
   
</section>

<style>
    .btn-todos{
        display: flex;
        align-items: center;
        justify-content: center;
        height: 40px;
        text-decoration: none;
        color: #007D7A;
        border: 1px solid #007D7A;
        padding: 8px 24px;
        border-radius: 40px;
        margin: auto;
        background-color: white;
        font-weight: 600;
    }
    .btn-todos:hover{
        color: #006969;
        border: 1px solid #006969;
    }

    .btn-todos:active{
        color: #025257;
        border: 1px solid #025257;
    }
    .events-section {
        max-width: 74.1rem;
        margin: auto;
        text-align: center;
        display: flex;
        flex-direction: column;
        gap: 40px;
        overflow: hidden;
    }
    
    .wrapper-texts {
        margin-bottom: 10px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    
    .h2-title {
        margin: 0;
        font-size: 40px;
        font-weight: 600;
        color: #434A54;
    }
    
    .sub-title {
        font-size: 20px;
        font-weight: 400;
        margin: 10px 0 0 0;
        color: #434A54;
    }
    
    .wrapper {
        position: relative;
        width: 1142px;
        margin: auto;
    }
    
    .events-carousel-container {
        position: relative;
        max-width: 1142px;
        margin: auto;
    }
    
    .events-carousel-items {
        display: flex;
        transition: transform 0.3s ease-in-out;
        gap: 25px;
        cursor: grab;
        width: calc(100% + 25px); /* Compensa o gap */
        margin-right: -25px;
    }
    
    .events-carousel-items:active {
        cursor: grabbing;
    }
    
    .events-carousel-item {
        flex-shrink: 0;
        width: 367px;
        margin-right: 0; /* Remove qualquer margem extra */
    }
    
    .events-item-link {
        text-decoration: none;
        color: inherit;
        display: block;
    }
    
    .events-carousel-item-content {
        display: flex;
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid #C8D1E0;
    }
    
    .events-carousel-datetime {
        width: 35%;
        border-radius: 8px 0 0 8px;
        overflow: hidden;
        text-align: center;
        background-color: #EBEFF5;
        padding: 20px 10px;
        height: 216px;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    
    .event-date {
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    
    .event-day {
        font-size: 44px;
        color: #007D7A;
        font-weight: 700;
        line-height: 1;
    }
    
    .event-month-year {
        margin: 5px 0;
    }
    
    .text-date {
        font-size: 16px;
        color: #58606E;
        font-weight: 300;
        text-align: center;
    }
    
    .event-time {
        font-size: 14px;
        color: #58606E;
        margin-top: 10px;
    }
    
    .events-carousel-content {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        justify-content: space-between;
        width: 65%;
        background-color: white;
        height: 216px;
        padding: 20px;
        text-align: left;
    }
    
    .event-tag {
        border: 1px solid #FC7D5C;
        font-size: 14px;
        color: #FC7D5C;
        border-radius: 24px;
        padding: 0px 15px;
        display: inline-block;
    }
    
    .events-title {
        font-size: 20px;
        color: #007D7A;
        text-decoration: none;
        font-weight: 500;
        margin: 10px 0;
    }
    
    .card-text {
        font-family: "Georama", serif;
        text-align: left;
        margin: 0;
        font-size: 14px;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
    }
    
    .event-location {
        font-size: 14px;
        color: #58606E;
    }
    
    .events-carousel-control {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        font-size: 30px;
        color: #333;
        cursor: pointer;
        border: none;
        background-color: transparent;
        z-index: 10;
    }
    
    .events-carousel-control-prev {
        left: -30px;
    }
    
    .events-carousel-control-next {
        right: -30px;
    }
    
    .btn {
        border: none;
        border-radius: 32px;
        color: #007D7A;
        text-decoration: none;
        display: inline-block;
        margin-top: 20px;
    }
    
    /* Estilos responsivos */
    @media (max-width: 992px) {
        .events-section {
            gap: 30px;
        }
        
        .h2-title {
            font-size: 32px;
        }
        
        .sub-title {
            font-size: 18px;
        }

        .wrapper-texts {
        margin-bottom: 10px;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
    }
    }
    
    @media (max-width: 768px) {
        .events-carousel-item {
            width: 70vw;
            max-width: 400px;
        }
        
        .events-carousel-control {
            display: none;
        }
        
        .h2-title {
            font-size: 32px;
        }
        
        .sub-title {
            font-size: 16px;
        }
    }
    
    @media (max-width: 576px) {
        .events-carousel-item-content {
            flex-direction: column;
            height: auto;
        }
        
        .events-carousel-datetime {
            width: 100%;
            height: auto;
            border-radius: 8px 8px 0 0;
            padding: 15px;
        }
        
        .events-carousel-content {
            width: 100%;
            height: auto;
            padding: 15px;
            gap: 10px;
        }
        
        .event-day {
            font-size: 36px;
        }
        
        .events-title {
            font-size: 18px;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
    const carousel = document.getElementById('events-carousel-items');
    const prevButton = document.querySelector('.events-carousel-control-prev');
    const nextButton = document.querySelector('.events-carousel-control-next');
    const items = carousel.querySelectorAll('.events-carousel-item');
    let currentIndex = 0;
    let startX, moveX, initialPosition;
    let isDragging = false;
    
    // Calcular largura dos itens e gap
    const itemWidth = items[0].offsetWidth;
    const itemsGap = 25;
    
    // Variáveis para calcular visibilidade e total de slides
    const totalItems = items.length;
    const containerWidth = carousel.parentElement.offsetWidth;
    const maxIndex = Math.max(0, totalItems - Math.floor(containerWidth / (itemWidth + itemsGap)));
    
    // Função para exibir o slide
    function showSlide(index) {
        currentIndex = Math.max(0, Math.min(index, maxIndex));
        const offset = currentIndex * (itemWidth + itemsGap);
        carousel.style.transform = `translateX(-${offset}px)`;
        
        // Controlar a visibilidade dos botões de navegação
        updateNavigationButtons();
    }
    
    // Função para atualizar a visibilidade dos botões de navegação
    function updateNavigationButtons() {
        // No primeiro grupo (índice 0), mostrar apenas a seta da direita
        if (currentIndex === 0) {
            prevButton.style.display = 'none';
            nextButton.style.display = 'block';
        } 
        // No último grupo, mostrar apenas a seta da esquerda
        else if (currentIndex >= maxIndex) {
            prevButton.style.display = 'block';
            nextButton.style.display = 'none';
        } 
        // Em grupos intermediários, mostrar ambas as setas
        else {
            prevButton.style.display = 'block';
            nextButton.style.display = 'block';
        }
    }
    
    // Inicializar a visibilidade dos botões
    updateNavigationButtons();
    
    // Controles de seta
    prevButton.addEventListener('click', () => {
        showSlide(currentIndex - 3);
    });
    
    nextButton.addEventListener('click', () => {
        showSlide(currentIndex + 3);
    });
    
    // Touch e arraste para mobile
    carousel.addEventListener('touchstart', handleStart, { passive: true });
    carousel.addEventListener('touchmove', handleMove, { passive: true });
    carousel.addEventListener('touchend', handleEnd, { passive: true });
    
    // Mouse para desktop (como fallback)
    carousel.addEventListener('mousedown', handleStart);
    carousel.addEventListener('mousemove', handleMove);
    carousel.addEventListener('mouseup', handleEnd);
    carousel.addEventListener('mouseleave', handleEnd);
    
    function handleStart(e) {
        isDragging = true;
        startX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
        initialPosition = currentIndex * (itemWidth + itemsGap);
        
        // Desativar transição durante o arrasto para melhor responsividade
        carousel.style.transition = 'none';
    }
    
    function handleMove(e) {
        if (!isDragging) return;
        
        moveX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
        const diff = moveX - startX;
        
        // Limitar o arrasto com efeito elástico
        if (currentIndex === 0 && diff > 50) {
            carousel.style.transform = `translateX(${diff / 3 - initialPosition}px)`;
        } else if (currentIndex === maxIndex && diff < -50) {
            carousel.style.transform = `translateX(${diff / 3 - initialPosition}px)`;
        } else {
            carousel.style.transform = `translateX(${diff - initialPosition}px)`;
        }
        
        // Prevenir o comportamento padrão (scroll da página) em mobile se estiver arrastando horizontalmente
        if (Math.abs(diff) > 10 && e.type === 'touchmove') {
            e.preventDefault();
        }
    }
    
    function handleEnd() {
        if (!isDragging) return;
        isDragging = false;
        
        // Restaurar transição
        carousel.style.transition = 'transform 0.3s ease-in-out';
        
        const diff = moveX - startX;
        const threshold = itemWidth / 4; // 25% da largura do item para considerar swipe
        
        if (diff > threshold) {
            showSlide(currentIndex - 1);
        } else if (diff < -threshold) {
            showSlide(currentIndex + 1);
        } else {
            showSlide(currentIndex);
        }
    }
    
    // Fix para links dentro do carrossel
    const links = carousel.querySelectorAll('a.events-item-link');
    links.forEach(link => {
        link.addEventListener('click', function(e) {
            if (isDragging || Math.abs(moveX - startX) > 10) {
                e.preventDefault();
            }
        });
    });
    
    // Ajustar o carrossel quando a janela é redimensionada
    window.addEventListener('resize', function() {
        const newItemWidth = items[0].offsetWidth;
        const newContainerWidth = carousel.parentElement.offsetWidth;
        const newMaxIndex = Math.max(0, totalItems - Math.floor(newContainerWidth / (newItemWidth + itemsGap)));
        
        // Recalcular o índice atual se necessário
        if (currentIndex > newMaxIndex) {
            currentIndex = newMaxIndex;
        }
        
        showSlide(currentIndex);
    });
});
</script>
{% endblock %}