# -*- coding:utf-8 -*-
from mako import runtime, filters, cache
UNDEFINED = runtime.UNDEFINED
STOP_RENDERING = runtime.STOP_RENDERING
__M_dict_builtin = dict
__M_locals_builtin = locals
_magic_number = 10
_modified_time = 1707919774.5285044
_enable_loop = True
_template_filename = '/home/niklas/projects/mvicon/mvicon/webui/pages/icon.html'
_template_uri = 'pages/icon.html'
_source_encoding = 'utf-8'
_exports = []


def render_body(context,**pageargs):
    __M_caller = context.caller_stack._push_frame()
    try:
        __M_locals = __M_dict_builtin(pageargs=pageargs)
        __M_writer = context.writer()
        __M_writer('<template tpl_id="page_icon_list">\n    <div>\n        <h2>Icons</h2>\n        <div class="row">\n            <div class="col-8">\n                <table class="icon-table table-modern">\n                    <thead ><tr>\n                        <td>Icon</td>\n                        <td>Name</td>\n                        <td>Category</td>\n                        <td>Variant Count</td>\n                        \n                    </tr></thead>\n                    <tbody class="icon-table-content">\n\n                        </div>          \n\n                    </tbody>\n                </table>\n            </div>\n            <div class="col-4">\n                <div class="icon-edit d-none">\n                    <div class="mb-3">\n                        <label for="icon_name" class="form-label">Icon Name</label>\n                        <input type="text" class="form-control" id="icon_name" placeholder="">\n                    </div>\n                    <div class="mb-3">\n                        <label for="iconcat" class="form-label">Category</label>\n                        <select class="form-select" id="iconcat" aria-label="Icon Category">\n                            <option selected>loading...</option>\n                        </select>\n                    </div>\n                               \n                    <button type="button" class="btn btn-primary" onclick="page_icons.save();return false;">\n                        <i class="fas fa-save"></i> Save\n                    </button>\n                    <button type="button" class="btn btn-secondary" onclick="page_icons.download();return false;">\n                        <i class="fas fa-download"></i> Download\n                    </button>\n                    \n                    <hr>\n                    <div class="mb-3">\n                        <label  class="form-label">Variants</label>\n                        <div class="icon-variants">\n                        </div>\n                    </div>\n                </div>\n            </div>\n       \n    </div>\n</template>\n<template tpl_id="icon_element">\n    <tr>\n        <td class="icon-icon"></td>\n        <td class="icon-name"></td>\n        <td class="icon-category"></td>\n        <td class="icon-variant_count"></td>\n        \n    </tr>\n\n</template>\n<template tpl_id="variant_select_element">\n    <div class="mb-3 row" style="font-size:8pt;">\n        <div class="col-3 variant_name"></div>\n        <div class="col-3 variant_color"></div>\n        <div class="col-3 variant_size"></div>\n        <div class="col-3 variant_active">\n            <input type="checkbox" class="form-check-input" />\n\n        </div>\n\n    </div>\n\n</template>\n\n\n\n\n\n<script>\n    var page_icons = {};\n    page_icons.show = function(){\n        $(".icon-edit").addClass("d-none");\n        node=$("#main-view-content").tpl("page_icon_list");\n        DoRequest("icons",{filter:""},function(data){\n            $(".icon-table-content").empty();\n            categories=Object.fromEntries(data.value.categories.map(item => [item.id, item.name]));\n\n            $.each(data.value.icons,function(index,item){\n                var node = $(".icon-table-content").appendtpl("icon_element");\n                node.find(".icon-icon").html(item.data);\n                node.find(".icon-icon").find("svg").attr("width","32").attr("height","32");\n                node.find(".icon-name").html(item.name);\n                node.find(".icon-variant_count").html(item.variant_count).attr("icon_id",item.id);\n                node.find(".icon-category").html(categories[item.category]);\n                $(".icon-table-content").append(node);\n                node.click(function(){page_icons.edit(item);});\n            });\n            $("#iconcat").empty();\n            $.each(data.value.categories,function(index,item){\n                var node = document.createElement("option");\n                node.innerHTML=item.name;\n                node.setAttribute("item_id",item.id);\n                $("#iconcat").append(node);\n            });\n    });\n};\n   page_icons.edit = function(item){\n       \n        $(".icon-edit").removeClass("d-none");\n\n        $("#icon_name").val(item.name).attr("icon_id",item.id);\n        $("#iconcat option[item_id="+item.category+"]").prop("selected",true);\n        //$("#icon_id").html("Icon ID: "+item.id).attr("icon_id",item.id);\n        let icon_id=item.id;\n        DoRequest("icon_variants",{icon_id:item.id},function(data){\n            $(".icon-variants").empty();\n\n\n            $.each(data.value.variants,function(index,item){\n                var node = $(".icon-variants").appendtpl("variant_select_element");\n                node.find(".variant_name").html(item.name);\n                node.find(".variant_color").html(item.color);\n                node.find(".variant_size").html(item.width+"x"+item.height);\n                node.find(".variant_active").find("input").attr("variant_id",item.id).attr("icon_id",icon_id).on("change",function(el){\n                    data={};\n                    data.icon_id=$(el.target).attr("icon_id");\n                    data.variant_id=$(el.target).attr("variant_id");\n                    data.active=$(el.target).prop("checked");\n                    DoRequest("update_icon_variant",data,function(data){\n                        $(".icon-variant_count[icon_id="+icon_id+"]").html(data.value + " (updated)");\n                    });\n                });\n                $(".icon-variants").append(node);\n            });\n            $.each(data.value.variants_active,function(index,item){\n                $(".icon-variants").find("input[variant_id="+item+"]").prop("checked",true);\n            });\n\n\n        });\n    }\n    page_icons.save = function(item){\n        data={}\n        data.icon_id=$("#icon_name").attr("icon_id");\n        data.name=$("#icon_name").val();\n        data.category_id=$("#iconcat option:selected").attr("item_id");\n        DoRequest("update_icon",data,function(data){\n            page_icons.show();\n        });\n    }\n    page_icons.download = function(){\n        DoDownload("download_icons",{icon_id:$("#icon_name").attr("icon_id")},"icon.zip");\n    }\n</script>')
        return ''
    finally:
        context.caller_stack._pop_frame()


"""
__M_BEGIN_METADATA
{"filename": "/home/niklas/projects/mvicon/mvicon/webui/pages/icon.html", "uri": "pages/icon.html", "source_encoding": "utf-8", "line_map": {"16": 0, "21": 1, "27": 21}}
__M_END_METADATA
"""
