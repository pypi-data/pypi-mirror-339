<template tpl_id="study_browser">
    <div class="flex-use-height">
        <h2>WÃ¤hle Studie</h2>
        <div class="study_list flex-use-height">
            <div class="flex-use-height">
                
                <div class="controls d-flex">

                    <div class="dropdown mr-2">
                        <select id="sortDropdownMenu" class="form-control" onchange="page_study_browser.sort(this.value)">
                            <option value="pseudorandom">Pseudorandom</option>
                            <option value="asc">Asc</option>
                            <option value="desc">Desc</option>
                            <option value="date_desc">Date Desc</option>
                            <option value="date_asc">Date Asc</option>
                        </select>
                    </div>

                    <button id="btn-back" class="btn btn-outline-primary mr-2" style="width: 150px;" onclick="page_study_browser.back()">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <button id="btn-forward" class="btn btn-outline-primary mr-2" style="width: 150px;"onclick="page_study_browser.forward()">
                        Forward <i class="fas fa-arrow-right"></i>
                    </button>
                    <div class="input-group mr-2">
                        <input type="text" id="filter-box" class="form-control" placeholder="Filter" oninput="page_study_browser.filter()">
                        <div class="input-group-append">
                            <span class="input-group-text"><i class="fas fa-filter"></i></span>
                        </div>
                    </div>
                </div>
            

                <div class="flex-use-height mt-2" style="overflow-y: auto;">
                    <table class="study-table table-modern">
                        <thead style="position: sticky; top: 0;">
                            <tr class="">
                                <td>Name</td>
                                <td>Kurzbeschreibung</td>
                                <td>Kommentar</td>
                                <td>Studienzahl</td>

                            </tr>
                        </thead>
                        <tbody class="study-content"></tbody>
                    </table>
                </div>
                <div class="col-4">
                </div>

            </div>
        </div>


    </div>
</template>
<template tpl_id="study_item">
    <tr class="" style="font-size:12pt;">
        <td class="study-name"></td>
        <td class="study-short" style="font-size:7pt;"></td>
        <td class="study-comment"></td>
        <td class="study-state">

        </td>

    </tr>

</template>

<script>
    var selected_study="";
    var pos=0;
    var limit=30;
    page_study_browser = {};
    page_study_browser.show = function () {
        node = $("#main-view-content").tpl("study_browser");
        page_study_browser.load();
        $("#sortDropdownMenu").val("pseudorandom");
    }
    page_study_browser.load=function(){
        filter=$("#filter-box").val();
        if (filter.length<3)filter="";
        
        order_mode=$("#sortDropdownMenu").val();

        DoRequest("get_study_list", {"token":session_token,"project":selected_project,"from":pos,"filter":filter,"order_mode":order_mode}, function (data) {
            if (data.value) {
                $(".study-content").empty();
                for (var i = 0; i < data.value.length; i++) 
                {
                    let study = data.value[i];
                    let index = i+pos;
                    let node = $(".study-content").appendtpl("study_item");
                    node.find(".study-name").text(study.name);
                    node.find(".study-short").text(study.short);
                    node.find(".study-comment").text(study.comment);
                    node.find(".study-state").text(study.state);
                    
                    node.click(function(){
                        selected_study=$(this).find(".study-name").text();
                        study_viewer.start_list(study.id,index ,{"token":session_token,"project":selected_project,"from":pos,"filter":filter,"order_mode":order_mode});
                    });
                    //$(".main-view-sidenav").removeClass("d-none");
                
                }
            }
        });
    }
    page_study_browser.back=function(){
        if (pos==0) return;
        pos-=limit;
        if(pos<0) pos=0;
        page_study_browser.load();
    }
    page_study_browser.forward=function(){
        pos+=limit;
        page_study_browser.load();
    }
    page_study_browser.filter=function(){
        page_study_browser.load();
    }
    page_study_browser.sort=function(type){
        page_study_browser.load();
        
    }


</script>