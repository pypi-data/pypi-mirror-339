"use strict";(self.webpackChunk_jupytercad_jupytercad_lab=self.webpackChunk_jupytercad_jupytercad_lab||[]).push([[484],{484:(e,t,a)=>{a.r(t),a.d(t,{default:()=>v});var o=a(75),r=a(189),n=a(908),d=a(543),i=a(128),s=a(579),l=a(498),c=a(569),u=a(230),g=a(256),h=a(173),p=a(545),y=a(808),m=a(369);class C extends h.JupyterYModel{}class M extends g.Panel{constructor(e){super(),this.onResize=()=>{this._jcadWidget&&u.MessageLoop.sendMessage(this._jcadWidget,g.Widget.ResizeMessage.UnknownSize)},this._buildWidget=e=>{const{commands:t,workerRegistry:a,model:r,externalCommands:n,tracker:d}=e,i=new o.JupyterCadPanel({model:r,workerRegistry:a});let s;r.filePath&&(s=new o.ToolbarWidget({commands:t,model:r,externalCommands:(null==n?void 0:n.getCommands())||[]})),this._jcadWidget=new o.JupyterCadOutputWidget({model:r,content:i,toolbar:s}),this.addWidget(this._jcadWidget),null==d||d.add(this._jcadWidget)};const{model:t}=e;this.addClass("jupytercad-notebook-widget"),this._buildWidget(e),t.sharedModel.changed.connect(((t,a)=>{a.stateChange&&a.stateChange.forEach((t=>{var a;"path"===t.name&&(null===(a=this.layout)||void 0===a||a.removeWidget(this._jcadWidget),this._jcadWidget.dispose(),this._buildWidget(e))}))}))}get jcadWidget(){return this._jcadWidget}}const k={id:"jupytercad:yjswidget-plugin",autoStart:!0,requires:[r.IJCadWorkerRegistryToken],optional:[r.IJCadExternalCommandRegistryToken,r.IJupyterCadDocTracker,h.IJupyterYWidgetManager,l.ICollaborativeDrive],activate:(e,t,a,o,n,d)=>{n?n.registerWidget("@jupytercad:widget",class extends C{async initialize(t){const{path:a,format:o,contentType:n}=t,i=o;if(!d)throw(0,c.showErrorMessage)("Error using the JupyterCAD Python API","You cannot use the JupyterCAD Python API without a collaborative drive. You need to install a package providing collaboration features (e.g. jupyter-collaboration)."),new Error("Failed to create the YDoc without a collaborative drive");let s="";const l=e.shell.currentWidget;(l instanceof m.NotebookPanel||l instanceof p.ConsolePanel)&&(s=l.sessionContext.path);let u="";if(a){u=y.PathExt.join(y.PathExt.dirname(s),a);try{await e.serviceManager.contents.get(u)}catch(t){await e.serviceManager.contents.save(u,{content:btoa("{}"),format:"base64"})}}else u=y.PathExt.join(y.PathExt.dirname(s),"unsaved_project");const g=d.sharedModelFactory.createNew({path:u,format:i,contentType:n,collaborative:!0});this.jupyterCADModel=new r.JupyterCadModel({sharedModel:g}),this.jupyterCADModel.contentsManager=e.serviceManager.contents,this.jupyterCADModel.filePath=u,this.ydoc=this.jupyterCADModel.sharedModel.ydoc,this.sharedModel=new h.JupyterYDoc(t,this.ydoc)}},class{constructor(r,n){this.yModel=r,this.node=n;const d=new M({commands:e.commands,externalCommands:a,model:r.jupyterCADModel,workerRegistry:t,tracker:o});u.MessageLoop.sendMessage(d,g.Widget.Msg.BeforeAttach),n.appendChild(d.node),u.MessageLoop.sendMessage(d,g.Widget.Msg.AfterAttach)}}):console.error("Missing IJupyterYWidgetManager token!")}};var j=a(590);const W="jupytercad",v=[{id:"jupytercad:lab:main-menu",autoStart:!0,requires:[r.IJupyterCadDocTracker,r.IJCadFormSchemaRegistryToken,r.IJCadWorkerRegistryToken],optional:[i.IMainMenu,s.ITranslator,d.ICompletionProviderManager],activate:(e,t,a,r,n,d,i)=>{console.log("jupytercad:lab:main-menu is activated!"),d=null!=d?d:s.nullTranslator;(0,o.addCommands)(e,t,d,a,r,i),n&&function(e,t){e.fileMenu.addItem({command:o.CommandIDs.exportJcad}),e.editMenu.undoers.redo.add({id:o.CommandIDs.redo,isEnabled:t}),e.editMenu.undoers.undo.add({id:o.CommandIDs.undo,isEnabled:t})}(n,(()=>null!==t.currentWidget&&t.currentWidget===e.shell.currentWidget))}},{id:"jupytercad:lab:controlpanel",autoStart:!0,requires:[n.ILayoutRestorer,r.IJupyterCadDocTracker,r.IAnnotationToken,r.IJCadFormSchemaRegistryToken],optional:[l.ICollaborativeDrive,j.IForkManagerToken],activate:(e,t,a,r,n,d,i)=>{const s=new o.ControlPanelModel({tracker:a}),l=new o.LeftPanelWidget({model:s,tracker:a,formSchemaRegistry:n});l.id="jupytercad::leftControlPanel",l.title.caption="JupyterCad Control Panel",l.title.icon=o.logoIcon;const c=new o.RightPanelWidget({model:s,tracker:a,annotationModel:r,forkManager:i,collaborativeDrive:d});c.id="jupytercad::rightControlPanel",c.title.caption="JupyterCad Control Panel",c.title.icon=o.logoIcon,t&&(t.add(l,W),t.add(c,W)),e.shell.add(l,"left",{rank:2e3}),e.shell.add(c,"right",{rank:2e3,activate:!1})}},k]}}]);